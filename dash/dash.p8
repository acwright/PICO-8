pico-8 cartridge // http://www.pico-8.com
version 18
__lua__
--dash
--by zander

function _init()
	player=init_player()
	monsters={}
	
	local monster1=init_monster(6,12)
	local monster2=init_monster(0,4)
	
	add(monsters,monster1)
	add(monsters,monster2)
	
	music(0)
end

function _update60()
	player:update()
	for monster in all(monsters) do
		monster:update()
	end
end

function _draw()
	cls(3)
	map(0)
	player:draw()
	for monster in all(monsters) do
		monster:draw()
	end
end
-->8
--helpers

function cmap(o,flag)
  local ct=false

  local x1=o.x/8
  local y1=o.y/8
  local x2=(o.x+7)/8
  local y2=(o.y+7)/8
  local a=fget(mget(x1,y1),flag)
  local b=fget(mget(x1,y2),flag)
  local c=fget(mget(x2,y2),flag)
  local d=fget(mget(x2,y1),flag)
  ct=a or b or c or d

  return ct
end
-->8
--init player

function init_player()
	return {
		x=0,
		y=0,
		update=function(self)
			local new_player={
				x=self.x,
				y=self.y
			}
			
			if btnp(1) then new_player.x+=8 end
			if btnp(0) then new_player.x-=8 end
			if btnp(3) then new_player.y+=8 end
			if btnp(2) then new_player.y-=8 end
			
			if new_player.x<0 then new_player.x=0 end
			if new_player.y<0 then new_player.y=0 end
			if new_player.x>120 then new_player.x=120 end
			if new_player.y>120 then new_player.y=120 end
			
			if not cmap(new_player,0) then
				self.x=new_player.x
				self.y=new_player.y
			end
			
			if cmap(new_player,1) then
				self.x=0
				self.y=0
			end
			
			if cmap(new_player,2) then
				music(-1)
				sfx(0)
				self.x=0
				self.y=0
				music(0)
			end
		end,
		draw=function(self)
			spr(3,self.x,self.y)
		end
	}
end
-->8
--init monster

function init_monster(col,row)
	return {
		x=col*8,
		y=row*8,
		t=60,
		update=function(self)
			if self.t==0 then
				local rnd_x=flr(rnd(3))-1
				local new_x=(self.x+(8*rnd_x))
				
				if new_x<0 then new_x=0 end
				if new_x>120 then new_x=120 end

				if not cmap({
					x=new_x,
					y=self.y
				},0) then
					self.x=new_x
				end
				
				local rnd_y=flr(rnd(3))-1
				local new_y=(self.y+(8*rnd_y))
				
				if new_y<0 then new_y=0 end
				if new_y>120 then new_y=120 end
				
				if not cmap({
					x=self.x,
					y=new_y
				},0) then
					self.y=new_y
				end
				self.t=60
			else
				self.t-=1
			end
		end,
		draw=function(self)
			spr(2,self.x,self.y)
		end
	}
end
__gfx__
00000000645ff544000000000000000044444444cccccccc88598855444444460000000000000000000000000000000000000000000000000000000000000000
000000005445544588899888299999904bbbbbb4ccccc7cc58889955454444440000000000000000000000000000000000000000000000000000000000000000
007007004445544608899880298998904bbbbbb4cccc7c7c89898859644445440000000000000000000000000000000000000000000000000000000000000000
000770004489984400899800298998904bbaabb4cc7ccccc98999998444546440000000000000000000000000000000000000000000000000000000000000000
00077000489a998400000000299999904bbaabb4c7c7cccc95999959444444450000000000000000000000000000000000000000000000000000000000000000
0070070048a99a8400000000299889904bbbbbb4cccccccc89998985454444440000000000000000000000000000000000000000000000000000000000000000
000000004488884400000000299289904bbbbbb4cccccccc89899998444444440000000000000000000000000000000000000000000000000000000000000000
0000000056444445000000000000000044444444cccccccc99885898444454640000000000000000000000000000000000000000000000000000000000000000
__gff__
0004000001020200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__map__
0707070707070407070707070704040400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0404040404070407040404040707070400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0404070707070707050505040404070400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0404070404070405050505040404070400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0707070404070404040404040404070400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0404070404070707070707070407070400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0404070404040407040404070404070400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0404070404040404040707070406060600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0407070705050504040704040606060600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0407040405050504040704060606060600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0407040407050504040704040404040400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0407040407040404040704040404040400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0407040407040707070704040407070700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0404040407070704040707040407040700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0404040404040404040407070707040700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0404040404040404040404040404040100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__sfx__
000600000415006150071500a1500c1500d1500d1500f150101501115012150141501615017150191501b1501c1501e1501e150211502215025150271502a1502b1502d1502f1503115034150371503a1503b150
001c0000181301a1301c1301d1301f130181301a1301c1301f130181301a1301c1301f130181301f13018130181301a1301c1301d1301f130181301a1301c1301f130181301d1301c13018130181301813018130
__music__
03 01424344

